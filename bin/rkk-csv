#!/usr/bin/env node
var Radkummerkasten = require('../src/Radkummerkasten')
var csvWriter = require('csv-write-stream')
var ArgHandler = require('../src/cliHandleArguments')

var parser = ArgHandler.init()
var args = ArgHandler.parseArgs()

var headers = [ 'id', 'bezirk', 'category', 'categoryName', 'status', 'lat', 'lon' ]
if (args.details) {
  headers = [ 'id', 'title', 'bezirk', 'user', 'date', 'category', 'categoryName', 'status', 'likes', 'lat', 'lon', 'text', 'commentsCount', 'attachmentsCount' ]
}

var writer = csvWriter({
  headers: headers
})
writer.pipe(process.stdout)

var filter = ArgHandler.compileFilter(args)

Radkummerkasten.getEntries(
  filter,
  function (err, entry) {
    if (err) {
      throw (err)
    }

    writer.write(entry)
  },
  function (err) {
    if (err) {
      throw (err)
    }

    writer.end()
  }
)
